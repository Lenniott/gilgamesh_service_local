# Gilgamesh Service Architecture Diagrams

## Overview
This document contains high-level architecture diagrams that serve as the "guiding star" for all documentation. These diagrams ensure consistency across data storage, API endpoints, and system components.

## 1. System Architecture Overview

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           GILGAMESH SERVICE                               │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐        │
│  │   CLIENT APPS   │    │   WEB INTERFACE │    │   API CLIENTS   │        │
│  │                 │    │                 │    │                 │        │
│  └─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘        │
│            │                      │                      │                  │
│            └──────────────────────┼──────────────────────┘                  │
│                                   │                                        │
│  ┌────────────────────────────────┼────────────────────────────────────┐   │
│  │                    FASTAPI APPLICATION                             │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │   API ENDPOINTS │  │  RATE LIMITING  │  │  HEALTH CHECKS  │   │   │
│  │  │                 │  │                 │  │                 │   │   │
│  │  └─────────┬───────┘  └─────────┬───────┘  └─────────┬───────┘   │   │
│  │            │                    │                    │             │   │
│  │  ┌─────────────────────────────────────────────────────────────┐   │   │
│  │  │                CORE PROCESSING PIPELINE                   │   │   │
│  │  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐       │   │   │
│  │  │  │   VIDEO     │  │   SCENE     │  │   AI        │       │   │   │
│  │  │  │ PROCESSING  │  │  DETECTION  │  │  ANALYSIS   │       │   │   │
│  │  │  └─────────────┘  └─────────────┘  └─────────────┘       │   │   │
│  │  └─────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  ┌────────────────────────────────┼────────────────────────────────────┐   │
│  │                    DATA STORAGE LAYER                             │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │   POSTGRESQL    │  │     QDRANT      │  │   FILE STORAGE  │   │   │
│  │  │   (Metadata)    │  │   (Vectors)     │  │   (Video Clips) │   │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  ┌────────────────────────────────┼────────────────────────────────────┐   │
│  │                    EXTERNAL SERVICES                              │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │    OPENAI       │  │     GEMINI      │  │   YOUTUBE/      │   │   │
│  │  │   (GPT-4)      │  │   (Gemini 2.0)  │  │  INSTAGRAM      │   │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 2. Data Flow Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATA FLOW ARCHITECTURE                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. INPUT PROCESSING                                                        │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   URL       │───▶│  VALIDATION │───▶│  DOWNLOAD   │                    │
│  │  INPUT      │    │             │    │  SERVICE    │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  2. VIDEO PROCESSING                                                       │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   VIDEO     │───▶│   SCENE     │───▶│   CLIP      │                    │
│  │  DOWNLOAD   │    │  DETECTION  │    │  EXTRACTION │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  3. AI ANALYSIS                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   AUDIO     │───▶│  TRANSCRIPT │───▶│   SCENE     │                    │
│  │ EXTRACTION  │    │  GENERATION │    │ DESCRIPTION │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  4. STORAGE & INDEXING                                                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   METADATA  │───▶│   VECTOR    │───▶│   FILE      │                    │
│  │  STORAGE    │    │  INDEXING   │    │  STORAGE    │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  5. COMPILATION                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   SEARCH    │───▶│   STITCH    │───▶│   OUTPUT    │                    │
│  │  & MATCH    │    │  VIDEOS     │    │  GENERATION │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 3. Database Schema Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           DATABASE ARCHITECTURE                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  POSTGRESQL (Metadata Storage)                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                        simple_videos                               │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │     id      │  │     url     │  │  created_at │  │  title  │   │   │
│  │  │   (UUID)    │  │   (TEXT)    │  │  (TIMESTAMP)│  │ (TEXT)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │  duration   │  │  file_size  │  │  metadata   │  │  status │   │   │
│  │  │   (FLOAT)   │  │   (BIGINT)  │  │  (JSONB)    │  │ (TEXT)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  ┌────────────────────────────────┼────────────────────────────────────┐   │
│  │                        video_clips                               │   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │     id      │  │  video_id   │  │  scene_id   │  │clip_path│   │   │
│  │  │   (UUID)    │  │   (UUID)    │  │   (UUID)    │  │ (TEXT)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │ start_time  │  │  end_time   │  │  duration   │  │file_size│   │   │
│  │  │   (FLOAT)   │  │   (FLOAT)   │  │   (FLOAT)   │  │(BIGINT) │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  QDRANT (Vector Storage)                                                   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    video_embeddings                               │   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │   point_id  │  │   vector    │  │  video_id   │  │  type   │   │   │
│  │  │   (UUID)    │  │  (1536 dim) │  │   (UUID)    │  │ (TEXT)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │  content    │  │  timestamp  │  │  metadata   │  │  score  │   │   │
│  │  │   (TEXT)    │  │   (FLOAT)   │  │  (JSON)     │  │(FLOAT)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│  FILE STORAGE (Video Clips)                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    /storage/clips/                                │   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │  2024/01/   │  │  2024/02/   │  │  2024/03/   │  │  ...    │   │   │
│  │  │video_id_1/  │  │video_id_2/  │  │video_id_3/  │  │         │   │   │
│  │  │scene_001.mp4│  │scene_001.mp4│  │scene_001.mp4│  │         │   │   │
│  │  │scene_002.mp4│  │scene_002.mp4│  │scene_002.mp4│  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 4. API Endpoints Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           API ENDPOINTS ARCHITECTURE                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  CORE PROCESSING ENDPOINTS                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  POST /process                                                     │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │     url     │  │ save_video  │  │ transcribe  │  │describe │   │   │
│  │  │   (URL)     │  │  (BOOLEAN)  │  │  (BOOLEAN)  │  │(BOOLEAN)│   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │save_to_pg   │  │save_to_qd   │  │include_b64  │  │raw_trans│   │   │
│  │  │  (BOOLEAN)  │  │  (BOOLEAN)  │  │  (BOOLEAN)  │  │(BOOLEAN)│   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  VECTORIZATION ENDPOINTS                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  POST /vectorize/existing                                          │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │    limit    │  │  dry_run    │  │  verbose    │  │         │   │   │
│  │  │   (INT)     │  │  (BOOLEAN)  │  │  (BOOLEAN)  │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  POST /qdrant/force-index                                         │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │ collections │  │force_rebuild│  │             │  │         │   │   │
│  │  │   (LIST)    │  │  (BOOLEAN)  │  │             │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  RETRIEVAL ENDPOINTS                                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  GET /video/{video_id}                                            │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │  video_id   │  │include_b64  │  │             │  │         │   │   │
│  │  │   (UUID)    │  │  (BOOLEAN)  │  │             │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  GET /carousel                                                    │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │     url     │  │include_b64  │  │             │  │         │   │   │
│  │  │   (STRING)  │  │  (BOOLEAN)  │  │             │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  GET /search                                                      │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │      q      │  │    limit    │  │             │  │         │   │   │
│  │  │  (STRING)   │  │    (INT)    │  │             │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  GET /videos                                                      │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │    limit    │  │             │  │             │  │         │   │   │
│  │  │    (INT)    │  │             │  │             │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  SYSTEM ENDPOINTS                                                        │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  GET /                                                            │   │
│  │  GET /health                                                      │   │
│  │  GET /rate-limits                                                 │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 5. Processing Pipeline Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        PROCESSING PIPELINE ARCHITECTURE                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  1. INPUT VALIDATION & DOWNLOAD                                            │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   URL       │───▶│  VALIDATION │───▶│  DOWNLOAD   │                    │
│  │  INPUT      │    │             │    │  SERVICE    │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  2. VIDEO PROCESSING                                                       │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   VIDEO     │───▶│   SCENE     │───▶│   CLIP      │                    │
│  │  DOWNLOAD   │    │  DETECTION  │    │  EXTRACTION │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  3. AI ANALYSIS                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   AUDIO     │───▶│  TRANSCRIPT │───▶│   SCENE     │                    │
│  │ EXTRACTION  │    │  GENERATION │    │ DESCRIPTION │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  4. STORAGE & INDEXING                                                     │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   METADATA  │───▶│   VECTOR    │───▶│   FILE      │                    │
│  │  STORAGE    │    │  INDEXING   │    │  STORAGE    │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
│                              │                                              │
│  5. COMPILATION                                                             │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                    │
│  │   SEARCH    │───▶│   STITCH    │───▶│   OUTPUT    │                    │
│  │  & MATCH    │    │  VIDEOS     │    │  GENERATION │                    │
│  └─────────────┘    └─────────────┘    └─────────────┘                    │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 6. Component Interaction Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                      COMPONENT INTERACTION ARCHITECTURE                    │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  EXTERNAL INTERFACES                                                       │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐        │
│  │   YOUTUBE       │    │   INSTAGRAM     │    │   OTHER         │        │
│  │   DOWNLOADER    │    │   DOWNLOADER    │    │   SOURCES       │        │
│  └─────────┬───────┘    └─────────┬───────┘    └─────────┬───────┘        │
│            │                      │                      │                  │
│  CORE PROCESSING COMPONENTS                                               │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │   VIDEO     │  │   SCENE     │  │   AUDIO     │  │  AI     │   │   │
│  │  │ PROCESSING  │  │  DETECTION  │  │ EXTRACTION  │  │ANALYSIS │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │ TRANSCRIPT  │  │   VECTOR    │  │   CLIP      │  │ STORAGE │   │   │
│  │  │ GENERATION  │  │  INDEXING   │  │ EXTRACTION  │  │MANAGER  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  DATA STORAGE COMPONENTS                                                  │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │ POSTGRESQL  │  │   QDRANT    │  │   FILE      │  │  CACHE  │   │   │
│  │  │  (METADATA) │  │  (VECTORS)  │  │  STORAGE    │  │         │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  AI SERVICES                                                              │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │   OPENAI    │  │   GEMINI    │  │   RATE      │  │ CIRCUIT │   │   │
│  │  │  (GPT-4)    │  │ (Gemini 2.0)│  │  LIMITER    │  │ BREAKER │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  OUTPUT GENERATION                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │   VIDEO     │  │   TEXT      │  │   METADATA  │  │  JSON   │   │   │
│  │  │ COMPILATION │  │  OVERLAYS   │  │  GENERATION │  │ OUTPUT  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 7. Deployment Architecture

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DEPLOYMENT ARCHITECTURE                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  DOCKER CONTAINER ORCHESTRATION                                            │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │                    gilgamesh-network                              │   │   │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐   │   │
│  │  │ gilgamesh-api   │  │    postgres     │  │     qdrant      │   │   │
│  │  │   (8500:8500)   │  │   (5432:5432)   │  │  (6333:6333)    │   │   │
│  │  │                 │  │                 │  │                 │   │   │
│  │  │ - FastAPI App   │  │ - PostgreSQL 15 │  │ - Vector DB     │   │   │
│  │  │ - Video Proc    │  │ - Metadata     │  │ - Embeddings    │   │   │
│  │  │ - AI Analysis   │  │ - User Data    │  │ - Similarity    │   │   │
│  │  │ - Rate Limiting │  │ - Clips Info   │  │ - Search        │   │   │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  VOLUME MOUNTS                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │ postgres_data│  │qdrant_data │  │  ./temp     │  │./cache  │   │   │
│  │  │  (Persistent)│  │ (Persistent)│  │ (Temporary) │  │(Cache)  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  EXTERNAL CONNECTIONS                                                      │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │   OPENAI    │  │   GEMINI    │  │   YOUTUBE   │  │INSTAGRAM│   │   │
│  │  │   API       │  │    API      │  │   API       │  │   API   │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  HEALTH MONITORING                                                         │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────┐   │   │
│  │  │   /health   │  │/rate-limits │  │  Database   │  │  AI API │   │   │
│  │  │   (Status)  │  │ (Usage)     │  │   Checks    │  │  Tests  │   │   │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## 8. Data Storage Strategy

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DATA STORAGE STRATEGY                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  METADATA STORAGE (PostgreSQL)                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  simple_videos table                                              │   │   │
│  │  - Video metadata (id, url, duration, file_size)                 │   │   │
│  │  - Scene descriptions (JSONB)                                     │   │   │
│  │  - Transcript data (JSONB)                                        │   │   │
│  │  - Processing status and timestamps                               │   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  video_clips table                                               │   │   │
│  │  - Clip file paths and metadata                                  │   │   │
│  │  - Scene timing information                                      │   │   │
│  │  - File size and duration data                                   │   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  VECTOR STORAGE (Qdrant)                                                 │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  video_embeddings collection                                     │   │   │
│  │  - 1536-dimensional embeddings (OpenAI text-embedding-3-small)   │   │   │
│  │  - Transcript segment vectors                                     │   │   │
│  │  - Scene description vectors                                      │   │   │
│  │  - Metadata for similarity search                                 │   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  FILE STORAGE (Local/Network)                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  /storage/clips/ structure                                       │   │   │
│  │  - Year/Month/VideoID organization                               │   │   │
│  │  - MP4 clip files for each scene                                 │   │   │
│  │  - Metadata JSON files                                           │   │   │
│  │  - Temporary processing files                                    │   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                   │                                        │
│  CACHE STORAGE (Temporary)                                                │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │  /app/cache/ directory                                           │   │   │
│  │  - Downloaded video files                                        │   │   │
│  │  - Processing artifacts                                          │   │   │
│  │  - AI model outputs                                              │   │   │
│  │  - Temporary compilation files                                   │   │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────┘
```

## Usage Guidelines

### For Documentation Consistency
1. **Reference these diagrams** in all documentation files
2. **Maintain consistency** with the data flow and component interactions shown
3. **Update diagrams** when architecture changes are made
4. **Use consistent terminology** across all documentation

### For Development
1. **Follow the data flow** shown in the processing pipeline
2. **Respect the API contract** defined in the endpoints architecture
3. **Maintain the database schema** structure shown
4. **Adhere to the deployment** patterns illustrated

### For Testing
1. **Test each component** according to the interaction architecture
2. **Validate data flow** through the processing pipeline
3. **Verify API endpoints** match the defined contract
4. **Check storage consistency** across all data stores

## Notes
- **Scalability**: Architecture supports horizontal scaling of API containers
- **Reliability**: Circuit breaker and rate limiting ensure system stability
- **Maintainability**: Clear separation of concerns between components
- **Extensibility**: Modular design allows for easy addition of new features
- **Monitoring**: Built-in health checks and metrics for all components 